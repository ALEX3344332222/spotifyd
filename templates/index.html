<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/public/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Spotify</title>
</head>
<body class="bg-gray-700">

    <header class="bg-black shadow-md">
        <div class="container mx-auto p-4 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRv_XlwE3Rfkh212aHRURMDbXKJ2h0I9Aev7Q&s"  class="h-10 w-10">
                <h1 class="text-white font-bold">Spotify</h1>
            </div>
            <nav class="space-x-6">
                <a href="/" class="text-white hover:text-gray-900 font-semibold">Треки</a>
                <a href="/my-music" class="text-white hover:text-gray-900 font-semibold">Моя музыка</a>
            </nav>
        </div>
    </header>


    <div class="container mx-auto p-8">

        <form id="uploadForm" method="post" enctype="multipart/form-data" >
                <div class="max-w-sm">
                    <label class="block" for="file">
                      <input type="file" name="file" id="file" accept="audio/mp3" class="file-input file-input-bordered w-full max-w-xs" />
                    </label>
                    <button type="submit" name="file" id="file" accept="audio/mp3" class="mt-3 bg-gray-400 hover:bg-gray-600 text-gray-700 font-bold py-1 px-3 rounded">
                    Загрузить
                    </button>
                </div>
        </form>

        <div id="message" class="text-white mt-4"></div>
            <h1 class="text-white text-3xl font-bold mb-4 text-center">Музыка</h1>
        <div class="grid grid-cols-1 gap-4">
            {% for track in tracks %}
            <div class="bg-gray-400 p-3 rounded-lg shadow-lg">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <!-- Показ изображения обложки трека, если оно есть -->
                        {% if track.file_path_img %}
                        <img src="{{ track.file_path_img }}" alt="Track Image" class="h-16 w-16 rounded-lg object-cover">
                        {% else %}
                        <img src="/default_image.jpg" alt="Default Image" class="h-16 w-16 rounded-lg object-cover">
                        {% endif %}

                        <div>
                            <h2 class="text-xl font-semibold text-gray-900">{{ track.title }}</h2>
                            <p class="text-gray-700">{{ track.artist }}</p>
                        </div>
                    </div>
                    <!-- Аудиоплеер с уникальным ID -->
                    <audio id="audio-player-{{ loop.index }}" controls class="spotify-audio-player">
                        <source src="{{ track.file_path }}" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <style>
    .spotify-audio-player {
        width: 500px; /* Ширина плеера */
        height: 40px; /* Высота плеера */
        background-color: #1db954; /* Цвет фона как у Spotify */
        border-radius: 24px; /* Скругление углов */
        border: none; /* Без рамки */
        outline: none; /* Без обводки */
    }

    .spotify-audio-player::-webkit-media-controls {
        background-color: #1db954; /* Цвет фона контролов */
    }

    .spotify-audio-player::-webkit-media-controls-enclosure {
        background-color: #1db954; /* Цвет фона контейнера */
    }
</style>

    <script>

        const audioPlayers = document.querySelectorAll('audio');

        function stopAllExcept(currentAudio) {
            audioPlayers.forEach(audio => {
                if (audio !== currentAudio) {
                    audio.pause();
                    audio.currentTime = 0;
                }
            });
        }

        audioPlayers.forEach(audio => {
            audio.addEventListener('play', function () {
                stopAllExcept(audio);
            });
        });
    </script>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const formData = new FormData(this);
            const messageDiv = document.getElementById('message');

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    messageDiv.textContent = 'Файл успешно загружен!';
                    messageDiv.style.color = 'green';
                } else {
                    messageDiv.textContent = 'Ошибка при загрузке файла.';
                    messageDiv.style.color = 'red';
                }
            } catch (error) {
                messageDiv.textContent = 'Произошла ошибка: ' + error.message;
                messageDiv.style.color = 'red';
            }
        });
    </script>
</body>
</html>
